<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        <link rel="canonical" href="http://farmos.org/development/docker/">
        <link rel="shortcut icon" href="../../img/favicon.ico">
        <title>Docker - farmOS.org</title>
        <link href="../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../css/font-awesome.min.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/color-brewer.min.css">
        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->

        <script src="../../js/jquery-1.10.2.min.js" defer></script>
        <script src="../../js/bootstrap-3.0.3.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script>
        <script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-56974603-1', 'farmos.org');
            ga('send', 'pageview');
        </script> 
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
            <div class="container">

                <!-- Collapsed navigation -->
                <div class="navbar-header">
                    <!-- Expander button -->
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="../..">farmOS.org</a>
                </div>

                <!-- Expanded navigation -->
                <div class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">User Guide <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li >
    <a href="../../guide/">Introduction</a>
</li>
                                    
<li >
    <a href="../../guide/app/">Field Kit</a>
</li>
                                    
<li >
    <a href="../../guide/areas/">Mapping your farm</a>
</li>
                                    
<li >
    <a href="../../guide/logs/">Logging events</a>
</li>
                                    
  <li class="dropdown-submenu">
    <a href="#">Managing assets</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../guide/assets/">Introduction</a>
</li>
            
<li >
    <a href="../../guide/assets/plantings/">Plantings</a>
</li>
            
<li >
    <a href="../../guide/assets/animals/">Animals</a>
</li>
            
<li >
    <a href="../../guide/assets/equipment/">Equipment</a>
</li>
            
<li >
    <a href="../../guide/assets/compost/">Compost</a>
</li>
            
<li >
    <a href="../../guide/assets/sensors/">Sensors</a>
</li>
            
<li >
    <a href="../../guide/assets/groups/">Groups</a>
</li>
    </ul>
  </li>
                                    
<li >
    <a href="../../guide/location/">Movements and location</a>
</li>
                                    
<li >
    <a href="../../guide/quantity/">Quantity measurements</a>
</li>
                                    
<li >
    <a href="../../guide/inventory/">Inventory tracking</a>
</li>
                                    
<li >
    <a href="../../guide/people/">People</a>
</li>
                                    
<li >
    <a href="../../guide/import/">Import</a>
</li>
                                    
<li >
    <a href="../../guide/export/">Export</a>
</li>
                                    
<li >
    <a href="../../guide/quick/">Quick forms</a>
</li>
                                    
  <li class="dropdown-submenu">
    <a href="#">Community modules</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../guide/contrib/">Introduction</a>
</li>
            
<li >
    <a href="../../guide/contrib/eggs/">Eggs</a>
</li>
            
<li >
    <a href="../../guide/contrib/nutrient/">Nutrient</a>
</li>
            
<li >
    <a href="../../guide/contrib/organic/">Organic</a>
</li>
            
<li >
    <a href="../../guide/contrib/produce-safety/">Produce Safety</a>
</li>
    </ul>
  </li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Hosting <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li >
    <a href="../../hosting/">Getting started</a>
</li>
                                    
<li >
    <a href="../../hosting/installing/">Installing</a>
</li>
                                    
<li >
    <a href="../../hosting/updating/">Updating</a>
</li>
                                    
<li >
    <a href="../../hosting/googlemaps/">Google Maps</a>
</li>
                                    
<li >
    <a href="../../hosting/docker/">Docker</a>
</li>
                                    
<li >
    <a href="../../hosting/localization/">Localization</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown active">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Development <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li >
    <a href="../drupal/">Drupal</a>
</li>
                                    
<li >
    <a href="../projects/">Projects</a>
</li>
                                    
<li >
    <a href="../issue-queues/">Issue Queues</a>
</li>
                                    
<li >
    <a href="../architecture/">Architecture</a>
</li>
                                    
<li >
    <a href="../update-safety/">Update Safety</a>
</li>
                                    
<li class="active">
    <a href="./">Docker</a>
</li>
                                    
<li >
    <a href="../api/">API</a>
</li>
                                    
<li >
    <a href="../client/">Client</a>
</li>
                                    
<li >
    <a href="../release/">Release procedure</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Community <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li >
    <a href="../../community/contribute/">Contribute</a>
</li>
                                    
<li >
    <a href="../../community/monthly-call/">Monthly Call</a>
</li>
                                    
<li >
    <a href="../../community/farms/">Farms</a>
</li>
                                    
<li >
    <a href="../../community/maintainers/">Maintainers</a>
</li>
                                    
<li >
    <a href="../../community/supporters/">Supporters</a>
</li>
                                    
<li >
    <a href="../../community/press/">Press</a>
</li>
                                    
<li >
    <a href="../../community/trademark/">Trademark</a>
</li>
                                </ul>
                            </li>
                            <li >
                                <a href="../../faq/">FAQ</a>
                            </li>
                            <li >
                                <a href="../../donate/">Donate</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav navbar-right">
                        <li>
                            <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li >
                                <a rel="next" href="../update-safety/">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li >
                                <a rel="prev" href="../api/">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                            <li>
                                <a href="https://github.com/farmOS/farmOS.org/edit/7.x-1.x/docs/development/docker.md"><i class="fa fa-github"></i> Edit on GitHub</a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="main active"><a href="#developing-farmos-with-docker">Developing farmOS with Docker</a></li>
            <li><a href="#docker-compose">Docker Compose</a></li>
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<h1 id="developing-farmos-with-docker">Developing farmOS with Docker<a class="headerlink" href="#developing-farmos-with-docker" title="Permanent link">&para;</a></h1>
<p>For general information, see <a href="/hosting/docker">Hosting farmOS with Docker</a>.</p>
<h2 id="docker-compose">Docker Compose<a class="headerlink" href="#docker-compose" title="Permanent link">&para;</a></h2>
<p>The recommended approach for local farmOS development in Docker is to use
<a href="https://docs.docker.com/compose">Docker Compose</a> to run both the farmOS container and the database container
on your local host.</p>
<h3 id="install-docker-and-docker-compose">Install Docker and Docker Compose<a class="headerlink" href="#install-docker-and-docker-compose" title="Permanent link">&para;</a></h3>
<p>First, install Docker and Docker Compose:</p>
<ul>
<li><a href="https://docs.docker.com/engine/installation">Install Docker</a><ul>
<li>On Mac OS X, use "Docker for Mac" (not "Docker Toolbox")</li>
<li>On Windows, use "Docker for Windows" (not "Docker Toolbox")</li>
<li>On Linux, follow the directions on docker.com</li>
</ul>
</li>
<li><a href="https://docs.docker.com/compose/install">Install Docker Compose</a></li>
</ul>
<h3 id="create-containers">Create containers<a class="headerlink" href="#create-containers" title="Permanent link">&para;</a></h3>
<p>To create the farmOS Docker containers, start by creating a new farmOS directory
on your host:</p>
<pre><code>mkdir farmOS
cd farmOS
</code></pre>
<p>Next, copy the <code>docker-compose.development.yml</code> file into the directory and
rename it to <code>docker-compose.yml</code>:</p>
<pre><code>wget https://raw.githubusercontent.com/farmOS/farmOS/7.x-1.x/docker/docker-compose.development.yml
mv docker-compose.development.yml docker-compose.yml
</code></pre>
<p>Then, use <code>docker-compose up</code> to create the containers:</p>
<pre><code>sudo docker-compose up
</code></pre>
<p>This will create two containers: a farmOS application container, and a MariaDB
database container.</p>
<p>This will run the two containers in your open terminal window, and will print
Apage and MariaDB logs to the screen. This is useful for debugging, and you can
shut them down with Ctrl+C when you're done.</p>
<p>If you want to run these containers in the background, so you don't need to keep
your terminal window, add <code>-d</code> to the end of the command:</p>
<pre><code>sudo docker-compose up -d
</code></pre>
<p>Then you can shut them down and remove the containers with:</p>
<pre><code>sudo docker-compose down
</code></pre>
<h4 id="mac-specific-instructions">Mac Specific Instructions<a class="headerlink" href="#mac-specific-instructions" title="Permanent link">&para;</a></h4>
<p>Due to <a href="https://forums.docker.com/t/file-access-in-mounted-volumes-extremely-slow-cpu-bound">performance issues</a> with shared volumes in Docker for Mac, it is
recommended that you add <code>:delegated</code> to your volume definitions in
<code>docker-compose.yml</code>.</p>
<p>For example, instead of:</p>
<pre><code>volumes:
  - './db:/var/lib/mysql'
</code></pre>

<p>Replace with:</p>
<pre><code>volumes:
  - './db:/var/lib/mysql:delegated'
</code></pre>

<p>Do this for both the <code>db</code> and <code>www</code> container volumes.</p>
<h4 id="persistent-volumes">Persistent volumes<a class="headerlink" href="#persistent-volumes" title="Permanent link">&para;</a></h4>
<p>The <code>docker-compose.development.yml</code> file defines two Docker volumes that will
be mounted into the containers from your host directory:</p>
<ul>
<li><code>./www</code> - <code>/var/html/www</code> from the farmOS application container, which
  includes the entire farmOS codebase, <code>settings.php</code> file (for connecting to
  the database), and any files that are uploaded/created in farmOS.</li>
<li><code>./db</code> - <code>/var/lib/mysql</code> from the MariaDB database container, which contains
  the farmOS database.</li>
</ul>
<p>Both will be made available within the <code>farmOS</code> directory you created initially.</p>
<p>This is where you will be able to access the code for development purposes. It
is also how your database and files are persisted when the containers are
destroyed and rebuilt.</p>
<h4 id="file-ownership">File ownership<a class="headerlink" href="#file-ownership" title="Permanent link">&para;</a></h4>
<p>On a Linux host, all the files in <code>www</code> will have an owner and group of
<code>www-data</code>. For development purposes, it is recommended that you change the
owner of everything in the <code>www</code> container to your local user. This can be done
with the following command:</p>
<pre><code>sudo chown -R ${USER} www
</code></pre>
<p>This changes the owner of <em>everything</em> in /var/www/html to the currently logged
in user on the host. But it leaves the group alone (<code>www-data</code>).</p>
<h3 id="install-farmos">Install farmOS<a class="headerlink" href="#install-farmos" title="Permanent link">&para;</a></h3>
<p>Once the containers are up and running, you can install farmOS using the Drupal
installer. This is a simple step-by-step process that you will need to go
through when you first access the site in your browser.</p>
<h4 id="browser-address">Browser address<a class="headerlink" href="#browser-address" title="Permanent link">&para;</a></h4>
<p>If you are running Docker on Linux, you can simply go to <code>http://localhost</code> in
your browser. Otherwise, you may need to look up the IP address of the Docker
container that was created and access it that way.</p>
<p>To find the IP address of your farmOS container, use the following command:</p>
<pre><code>sudo docker inspect --format '{{ .NetworkSettings.Networks.farmos_default.IPAddress }}' farmos_www_1
</code></pre>
<p>Visit the IP address in a browser - you should see the Drupal/farmOS installer.</p>
<h4 id="database-setup">Database setup<a class="headerlink" href="#database-setup" title="Permanent link">&para;</a></h4>
<p>In the "Set up database" step of installation, use the following values:</p>
<ul>
<li>Database name: <code>farm</code></li>
<li>Database username: <code>farm</code></li>
<li>Database password: <code>farm</code></li>
<li>Under "Advanced options", change "Database host" to: <code>db</code></li>
</ul>
<p>Follow the instructions to continue with the installation and you should be left
with a fully-functioning farmOS instance running in a Docker container!</p>
<h3 id="updating-farmos">Updating farmOS<a class="headerlink" href="#updating-farmos" title="Permanent link">&para;</a></h3>
<p><strong>Important</strong>: these instructions are for updating a <em>development</em> environment
hosted with Docker. If you are running a production environment, see
<a href="/hosting/docker">Hosting farmOS with Docker</a>.</p>
<p>There are two ways to update your development codebase: incremental vs complete.</p>
<h4 id="incremental-update">Incremental update<a class="headerlink" href="#incremental-update" title="Permanent link">&para;</a></h4>
<p>An incremental update can be done if the changes are relatively simple. This
includes commits to the farmOS repository that do not include any of the
following:</p>
<ul>
<li>Updates to Drupal core</li>
<li>Updates to contrib modules</li>
<li>New contrib modules</li>
<li>New patches to Drupal core or contrib modules</li>
</ul>
<p>These things are handled by Drush Make, which is run during a complete update
(see below). If you are familiar with Drupal and Drush Make, it is possible to
make these updates incrementally as well, but if you are not then follow the
"Complete update" instructions below.</p>
<p>To perform an incremental update, run <code>git pull origin 7.x-1.x</code> in the farmOS
installation profile repository, which is inside <code>www/profiles/farm</code>:</p>
<pre><code>cd www/profiles/farm
git pull origin 7.x-1.x
</code></pre>
<h4 id="complete-update">Complete update<a class="headerlink" href="#complete-update" title="Permanent link">&para;</a></h4>
<p><strong>Warning</strong>: if you have made any changes to the code inside <code>www</code>, they
will be overwritten by this process. The one exception is the <code>www/sites</code>
directory, which will not be modified. It's a good idea to put extra modules
that you have downloaded/developed yourself into <code>www/sites/all/modules</code> for
this reason.</p>
<p>First, stop the containers and create a backup snapshot so that you can easily
restore if anything goes wrong. See "Backup/restore during development" below.</p>
<p>Pull the latest version of the farmOS Docker <code>dev</code> image:</p>
<pre><code>sudo docker pull farmos/farmos:dev
</code></pre>
<p>Stop the farmOS containers:</p>
<pre><code>sudo docker-compose down
</code></pre>
<p>Move the <code>sites</code> directory out of the webroot:</p>
<pre><code>sudo mv www/sites ./
</code></pre>
<p>Delete everthing in <code>www</code>:</p>
<pre><code>sudo rm -r www/{*,.*}
</code></pre>
<p>Restart the farmOS containers:</p>
<pre><code>sudo docker-compose up -d
</code></pre>
<p>The <code>www</code> container should be automatically populated again with the new
codebase.</p>
<p>Restore the <code>sites</code> directory:</p>
<pre><code>sudo rm -rf www/sites
sudo mv sites www
</code></pre>
<p>Run database updates by going to <code>/update.php</code> in your browser and following
the instructions.</p>
<p>You may also need to revert any overridden features in
<code>/admin/structure/features</code> (if they are not automatically). <strong>Warning</strong>: If
you have made any modifications to farmOS configuration, reverting features may
overwrite those changes.</p>
<p>If anything goes wrong during this process, you can restore to the backup you
created. See "Backup/restore during development" below.</p>
<h3 id="backuprestore-during-development">Backup/restore during development<a class="headerlink" href="#backuprestore-during-development" title="Permanent link">&para;</a></h3>
<p>During development, you can create quick snapshots of the database and/or
codebase from these volume directories. Simply shut down the running containers
and create tarball(s).</p>
<p><strong>Backup</strong>:</p>
<pre><code>sudo docker-compose down
sudo tar -czf backup.tar.gz db www
sudo docker-compose up -d
</code></pre>
<p><strong>Restore</strong></p>
<pre><code>sudo docker-compose down
sudo rm -rf db
sudo rm -rf www
sudo tar -xzf backup.tar.gz
sudo docker-compose up -d
</code></pre></div>
        </div>

        <footer class="col-md-12">
            <hr>
                <p><p><a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png" /></a><br /><span xmlns:dct="http://purl.org/dc/terms/" property="dct:title">farmOS.org</span> content is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/">Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License</a>.<br />farmOS is a <a href="/community/trademark">registered trademark</a> of <a href="http://mstenta.net">Michael Stenta</a></p><p><a href="/donate">Donate</a> to help support the farmOS project.</p>.</p>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "../..",
                shortcuts = {"previous": 80, "next": 78, "help": 191, "search": 83};
        </script>
        <script src="../../js/base.js" defer></script>
        <script src="../../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Search</h4>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form role="form">
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="Keyboard Shortcuts Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Keyboard Shortcuts</h4>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
