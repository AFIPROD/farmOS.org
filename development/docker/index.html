<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        <link rel="canonical" href="http://farmos.org/development/docker/">
        <link rel="shortcut icon" href="../../favicon.ico">
        

	<title>Docker - farmOS.org</title>

        <link href="../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../css/font-awesome-4.0.3.css" rel="stylesheet">
        <link rel="stylesheet" href="../../css/highlight.css">
        <link href="../../css/base.css" rel="stylesheet">

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        
        <script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-56974603-1', 'farmos.org');
            ga('send', 'pageview');
        </script>
        
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>

            <!-- Main title -->
            <a class="navbar-brand" href="../..">farmOS.org</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            <!-- Main navigation -->
            <ul class="nav navbar-nav">
            
            
                <li >
                    <a href="../..">Home</a>
                </li>
            
            
            
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">User Guide <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        
<li >
    <a href="../../guide/start/">Getting started</a>
</li>

                    
                        
<li >
    <a href="../../guide/dashboard/">Dashboard</a>
</li>

                    
                        
<li >
    <a href="../../guide/areas/">Mapping your farm</a>
</li>

                    
                        
<li >
    <a href="../../guide/assets/">Managing assets</a>
</li>

                    
                        
<li >
    <a href="../../guide/logs/">Logging events</a>
</li>

                    
                        
<li >
    <a href="../../guide/location/">Movements and location</a>
</li>

                    
                        
<li >
    <a href="../../guide/roles/">Roles</a>
</li>

                    
                        
<li >
    <a href="../../guide/demos/">Demos</a>
</li>

                    
                    </ul>
                </li>
            
            
            
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Hosting <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        
<li >
    <a href="../../hosting/installing/">Installing</a>
</li>

                    
                        
<li >
    <a href="../../hosting/updating/">Updating</a>
</li>

                    
                        
<li >
    <a href="../../hosting/googlemaps/">Google Maps</a>
</li>

                    
                    </ul>
                </li>
            
            
            
                <li class="dropdown active">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Development <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        
<li >
    <a href="../drupal/">Drupal</a>
</li>

                    
                        
<li >
    <a href="../projects/">Projects</a>
</li>

                    
                        
<li >
    <a href="../issue-queues/">Issue Queues</a>
</li>

                    
                        
<li >
    <a href="../architecture/">Architecture</a>
</li>

                    
                        
<li >
    <a href="../update-safety/">Update Safety</a>
</li>

                    
                        
<li class="active">
    <a href="./">Docker</a>
</li>

                    
                    </ul>
                </li>
            
            
            
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Community <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        
<li >
    <a href="../../community/contribute/">Contribute</a>
</li>

                    
                        
<li >
    <a href="../../community/monthly-call/">Monthly Call</a>
</li>

                    
                        
<li >
    <a href="../../community/farms/">Farms</a>
</li>

                    
                        
<li >
    <a href="../../community/maintainers/">Maintainers</a>
</li>

                    
                        
<li >
    <a href="../../community/supporters/">Supporters</a>
</li>

                    
                        
<li >
    <a href="../../community/press/">Press</a>
</li>

                    
                        
<li >
    <a href="../../community/trademark/">Trademark</a>
</li>

                    
                    </ul>
                </li>
            
            
            
                <li >
                    <a href="../../faq/">FAQ</a>
                </li>
            
            
            </ul>

            <!-- Search, Navigation and Repo links -->
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Search
                    </a>
                </li>
                <li >
                    <a rel="next" href="../update-safety/">
                        <i class="fa fa-arrow-left"></i> Previous
                    </a>
                </li>
                <li >
                    <a rel="prev" href="../../community/contribute/">
                        Next <i class="fa fa-arrow-right"></i>
                    </a>
                </li>
                
                <li>
                    <a href="https://github.com/farmOS">
                        
                            <i class="fa fa-github"></i>
                        
                        GitHub
                    </a>
                </li>
                
            </ul>
        </div>
    </div>
</div>

        <div class="container">
            <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#farmos-on-docker">farmOS on Docker</a></li>
        
            <li><a href="#general-info">General info</a></li>
        
            <li><a href="#local-development-with-docker-compose">Local development with Docker Compose</a></li>
        
    
    </ul>
</div></div>
            <div class="col-md-9" role="main">

<h1 id="farmos-on-docker">farmOS on Docker</h1>
<blockquote>
<p><a href="https://www.docker.com">Docker</a> is an open-source project that automates the deployment of applications
inside software containers. - <a href="https://en.wikipedia.org/wiki/Docker_(software)">Wikipedia</a></p>
</blockquote>
<p>A farmOS Docker image is available on <a href="https://hub.docker.com">Docker Hub</a> at
<a href="https://hub.docker.com/r/farmos/farmos">https://hub.docker.com/r/farmos/farmos</a>.
It is built automatically from the Dockerfile included with the
<a href="https://www.drupal.org/project/farm">farmOS distribution</a>, whenever new commits are pushed to the
<a href="https://github.com/farmOS/farmOS">farmOS GitHub repository</a>.</p>
<p>This can be used for local farmOS development purposes, or for hosting your own
farmOS instance on a web server with the help of Docker.</p>
<p><strong>This document primarily covers how to set up a local development environment
with Docker. It does not cover how to host a production farmOS instance. The
image should support this, but it is largely untested.</strong></p>
<h2 id="general-info">General info</h2>
<h3 id="environment-variables">Environment variables</h3>
<p>The farmOS Dockerfile exposes a few environment variables, which can be
overridden when the container is run.</p>
<ul>
<li><code>FARMOS_VERSION</code> - This is the tagged/packaged release of farmOS that should be
downloaded from drupal.org. This will be used if <code>FARMOS_DEV</code> is <code>false</code> (see
below). This will always be the most recently packaged release of farmOS.</li>
<li><code>FARMOS_DEV_BRANCH</code> - This is the branch that should be used for development
purposes. This will be used if <code>FARMOS_DEV</code> is <code>true</code> (see below). The default
is the branch you currently have checked out.</li>
<li><code>FARMOS_DEV</code> - This is a boolean variable to specify whether you want
to set up a development environment in the Docker container (when it is set to
<code>true</code>), or you want to use the official packaged release defined in
<code>FARMOS_VERSION</code> above (when it is set to <code>false</code>). The default is <code>false</code>. See
more detailed information about how this works below.</li>
</ul>
<h3 id="development-vs-production">Development vs production</h3>
<p>The Dockerfile can theoretically be used for either development or production
environments. The farmOS codebase will be set up differently, depending on the
status of the <code>FARMOS_DEV</code> environment variable.</p>
<p>When <code>FARMOS_DEV</code> is set to <code>true</code>, farmOS is built using <code>drush make</code> with the
<code>--working-copy</code> flag. This ensures that a working Git directory is checked out
for the farmOS installation profile (in <code>profiles/farm</code> within the built
codebase). It will use whatever branch is specified in the <code>FARMOS_DEV_BRANCH</code>
variable. The <code>FARMOS_VERSION</code> variable is ignored.</p>
<p>When <code>FARMOS_DEV</code> is set to <code>false</code> (this is the default), then the officially
packaged release of farmOS will be downloaded from drupal.org and unpacked in
the container. It will download the version specified in the <code>FARMOS_VERSION</code>
variable. The <code>FARMOS_DEV_BRANCH</code> variable is ignored.</p>
<h3 id="rebuilding-the-codebase">Rebuilding the codebase</h3>
<p>The farmOS Docker image assumes that the entire farmOS codebase (located in
<code>/var/www/html</code> within the container) will be mounted on the host as a
<a href="https://docs.docker.com/engine/tutorials/dockervolumes">Docker volume</a>. A Docker <code>ENTRYPOINT</code> script is included to ensure that the
farmOS codebase is created within that volume. When the container is destroyed,
everything in <code>/var/www/html</code> persists in the host volume.</p>
<p>Since the farmOS codebase is built in the <code>ENTRYPOINT</code> script, and not in the
Dockerfile, that means that updating your Docker image will not necessarily
update your farmOS codebase.</p>
<p>Therefore, the <code>ENTRTYPOINT</code> script has logic to decide if/when the farmOS
codebase should be rebuilt. Simply put, if you are running a packaged release of
farmOS, and a new version of farmOS is released, all you have to do is pull an
updated farmOS Docker image and rebuild your container to get the new version.</p>
<p>If, on the other hand, you have a development build (<code>FARMOS_DEV</code> is <code>true</code>),
then the only way to trigger a rebuild is to delete <code>profiles/farm/farm.info</code>.
Then, stop and start your container and the farmOS development codebase will be
rebuilt with <code>drush make</code>.</p>
<p>More specifically, farmOS will be rebuilt if one of the following is true:</p>
<ol>
<li><code>profiles/farm/farm.info</code> is missing, or:</li>
<li><code>FARMOS_DEV</code> is <code>false</code> and the version string in <code>profiles/farm/farm.info</code>
does not match <code>FARMOS_VERSION</code> in the Dockerfile.</li>
</ol>
<p>When the codebase is rebuilt, everything in <code>/var/www/html</code> is wiped out and
replaced automatically, with the exception of the <code>/var/www/html/sites</code>
directory - which is preserved across the rebuild. This ensures that Drupal's
<code>settings.php</code>, any uploaded files (in <code>sites/default/files</code>), and any
additional modules that you add to <code>sites/*/modules</code> are not lost when the
codebase is rebuilt.</p>
<p><strong>WARNING:</strong> If you have a development environment (created with <code>FARMOS_DEV</code>
set to <code>true</code>) and you have made changes to any of the working Git repositories
in <code>/var/www/html/profiles/farm</code>, they will be overwritten when the codebase is
rebuilt. The best way to avoid this is to copy any overridden modules/themes to
the <code>sites/all/modules</code> or <code>sites/all/themes</code> directory so that they are
preserved when the codebase is rebuilt.</p>
<p><strong>ALSO NOTE:</strong> When the codebase is rebuilt, it does NOT automatically run
update.php on the site. You must do this manually. See the <a href="../../hosting/updating">Updating farmOS</a>
page (specifically the steps for clearing cache and running database updates)
for more details.</p>
<h2 id="local-development-with-docker-compose">Local development with Docker Compose</h2>
<p>The recommended approach for local farmOS development in Docker is to use
<a href="https://docs.docker.com/compose">Docker Compose</a> to build both the farmOS container and the MariaDB database
container.</p>
<p>The <code>docker-compose.yml</code> file included with farmOS sets <code>FARMOS_DEV</code> to <code>true</code>
by default, so it is intended only for development purposes at this time.</p>
<h3 id="install-docker-and-docker-compose">Install Docker and Docker Compose</h3>
<p>First, install Docker and Docker Compose:</p>
<ul>
<li><a href="https://docs.docker.com/engine/installation">Install Docker</a><ul>
<li>On Mac OS X, use "dlite" (not "Docker for Mac" or "Docker Toolbox")</li>
<li>On Windows, use "Docker for Windows" (not "Docker Toolbox")</li>
<li>On Linux, follow the directions on docker.com</li>
</ul>
</li>
<li><a href="https://docs.docker.com/compose/install">Install Docker Compose</a></li>
</ul>
<h4 id="mac-specific-instructions">Mac Specific Instructions</h4>
<p>Due to <a href="https://forums.docker.com/t/file-access-in-mounted-volumes-extremely-slow-cpu-bound">performance issues</a> with shared volumes in Docker for Mac, <a href="https://github.com/nlf/dlite">dlite</a> is
currently the suggested way to host Docker images. The following sections
describe how to install dlite and start/stop containers:</p>
<h5 id="installing">Installing</h5>
<ol>
<li>Download the latest release from <a href="https://github.com/nlf/dlite/releases">dlite releases</a> on GitHub</li>
<li>Extract dlite from the tarball and copy it to <code>/usr/local/bin/dlite</code></li>
<li>Run: <code>chmod +x /usr/local/bin/dlite</code></li>
<li>Initialize dlite by running: <code>dlite init</code></li>
<li>Start dlite host by running: <code>dlite start</code></li>
</ol>
<h5 id="starting">Starting</h5>
<ol>
<li>Proceed with <a href="#create-containers">Create Containers</a></li>
<li>Fix networking by running <code>docker network connect bridge farmos_www_1</code></li>
<li>Proceed with <a href="#install-farmos">Install farmOS</a> at <a href="http://farmos_www_1.docker">http://farmos_www_1.docker</a></li>
</ol>
<h5 id="stopping">Stopping</h5>
<ol>
<li>Run: <code>docker-compose stop</code></li>
<li>Remove networking: <code>docker network disconnect bridge farmos_www_1</code></li>
</ol>
<h3 id="create-containers">Create containers</h3>
<p>To create the farmOS Docker containers, first clone the farmOS repository:</p>
<pre><code>git clone https://github.com/farmOS/farmOS.git &amp;&amp; cd farmOS
</code></pre>
<p>Then, use <code>docker-compose up</code> to create the containers:</p>
<pre><code>sudo docker-compose up
</code></pre>
<p>This will create two containers: a farmOS application container, and a MariaDB
database container.</p>
<p><strong>Note:</strong> It will take some time for the containers to start the first time.
This is because the farmOS codebase needs to be built when the container is run
(it is not built in the image itself). For this reason, you might not want to
use the <code>-d</code> flag at the end of <code>sudo docker-compose up</code>, so that you can see
the progress. Once it is built, stopping and starting the container is very
quick.</p>
<h3 id="persistent-volumes">Persistent volumes</h3>
<p>The docker-compose.yml file defines two Docker volumes that will be available on
your host system:</p>
<ul>
<li><code>/var/html/www</code> from the farmOS application container</li>
<li><code>/var/lib/mysql</code> from the MariaDB database container</li>
</ul>
<p>Both will be made available within a <code>.data</code> directory in the farmOS repository
on the host. This is where you will be able to access the code for development
purposes. It is also how your database and files are persisted when the
containers are destroyed and rebuilt.</p>
<h3 id="install-farmos">Install farmOS</h3>
<p>Once the containers are up and running, you can install farmOS using the Drupal
installer. This is a simple step-by-step process that you will need to go
through when you first access the site in your browser.</p>
<p>To find the IP address of your farmOS container, use the following command:</p>
<pre><code>sudo docker inspect --format '{{ .NetworkSettings.Networks.farmos_default.IPAddress }}' farmos_www_1
</code></pre>
<p>Visit the IP address in a browser - you should see the Drupal/farmOS installer.</p>
<p>In the "Set up database" step of installation, use the following values:</p>
<ul>
<li>Database name: <code>farmos</code></li>
<li>Database username: <code>farmos</code></li>
<li>Database password: <code>farmos</code></li>
<li>Under "Advanced options", change "Database host" to: <code>db</code></li>
</ul>
<p>Follow the instructions to continue with the installation and you should be left
with a fully-functioning farmOS instance running in a Docker container!</p>
<h3 id="stopstart-containers">Stop/start containers</h3>
<p>To stop your running containers:</p>
<pre><code>sudo docker-compose stop
</code></pre>
<p>To start your containers:</p>
<pre><code>sudo docker-compose start
</code></pre></div>
        </div>

        <footer class="col-md-12">
            <hr>
            
                <center><p><a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png" /></a><br /><span xmlns:dct="http://purl.org/dc/terms/" property="dct:title">farmOS.org</span> content is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/">Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License</a>.<br />farmOS is a <a href="/community/trademark">registered trademark</a> of <a href="http://mstenta.net">Michael Stenta</a></p>.</center>
            
            <center>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</center>
        </footer>

        <script src="../../js/jquery-1.10.2.min.js"></script>
        <script src="../../js/bootstrap-3.0.3.min.js"></script>
        <script src="../../js/highlight.pack.js"></script>
        <script>var base_url = '../..';</script>
        <script data-main="../../mkdocs/js/search.js" src="../../mkdocs/js/require.js"></script>
        <script src="../../js/base.js"></script>
        <script src="../../redirect/redirect.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                        <h4 class="modal-title" id="exampleModalLabel">Search</h4>
                    </div>
                    <div class="modal-body">
                        <p>
                            From here you can search these documents. Enter
                            your search terms below.
                        </p>
                        <form role="form">
                            <div class="form-group">
                                <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                            </div>
                        </form>
                        <div id="mkdocs-search-results"></div>
                    </div>
                    <div class="modal-footer">
                    </div>
                </div>
            </div>
        </div>
    </body>
</html>